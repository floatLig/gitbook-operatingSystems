# 1.1 操作系统的概念

> 读这一节的时候可以联系【机组】的知识。

一个完整的计算机系统是由硬件和软件两大部分组成的。

简单的说，软件是计算机执行的程序。大家说熟悉的WIndows XP， Microsoft Office Word，Linux都是属于软件的范畴。

在所有的软件中，操作系统（Operating System）占有特殊的重要地位，它是配置计算机硬件上的第一层软件，用于**控制硬件的工作**，**管理计算机系统的各种资源**，并为系统中各个程序的**提供服务**。众所周知的WIndows XP、Linux都是当前最流行的操作系统。

## 计算机硬件结构

### 特权指令和CPU工作模式

指令是控制计算机执行的某种操作（如加、减、传送、转移等）的命令。

在指令集中，有一类具有**特殊权限**，成为特权指令，用于操作系统或其他系统软件，普通用户不能直接使用。它主要用于系统资源的分配和管理，包括改变系统工作方式，检测用户的访问权限，控制I/O设备动作，等等。

多数CPU都提供两种运行模式：**内核态**（又称核心态、系统态、**管态**）和**用户态**（又称**目态**）。这是为了保护操作程序（特别是其内核部分）免受用于程序的干扰和损害。当用户程序在机器上运行时，CPU状态就处于用户态，其权限较低，只能执行非特权在执行。当发生中断或者系统调用的时候，CPU状态就变为了内核态，这样就可以执行操作系统的程序。

### 系统初启的一般过程

大家都知道，打开计算机电源后，计算机就开始初始过程，即引导操作系统。系统初始过程的细节和所用计算机的体系结构有关，但是对于所有的计算机来说，初始过程目的是相同的：**将操作系统的副本读入内存，建立正常的运行环境**。

#### 1. 硬件检测

当计算机加电启动时，首先CPU进入实模式，开始执行**ROM-BIOS初始位置的代码**。BIOS执行加电自检程序（POST），完成硬件启动，然后对系统中配置的**硬件**（如内存、硬盘及其他设备）**进行诊断检测**，确定各自在系统中存在，并且处于正常状态。自检工作要经历约2-3分钟。自检完成后，按照预先在系统CMOS中设置的启动顺序，ROM-BIOS搜索CD-ROM、硬盘或者软盘等设备的**驱动器**，读入系统引导区（通常时磁盘上第一个扇区）的程序，并将系统控制权引导装入程序。

#### 2. 加载引导程序

整个硬盘的第一个扇区是引导扇区。计算机加电后就从此处“引导”，所以称之为“主引导记录块”（MBR）。MBR中存有**磁盘分区的数据**和一段简短的程序，该程序并不直接引导操作系统，但他能根据盘区划分的信息找到**“活动”分区**，然后**从活动分区中将引导程序读到内存**，运行系统引导程序，它从磁盘中读入其他几个更为复杂的程序，由后者加载操作系统的内核。

内核加载完毕后，系统跳转到setup程序，并在实模式下运行。它设置系统参数（包括内存、磁盘等，由BIOS返回）、检测和设置显示器与显示模式等。最后进入保护模式，并转到内核映像的开头，执行内核初始化。

#### 3. 初始化内核

系统初始化过程可以分为三个阶段：

第一阶段主要是CPU本身的初始化，如设置内核页表、启动页面映射机制、建立系统的第一个进程、初始化内核的全局变量和静态变量、设置



